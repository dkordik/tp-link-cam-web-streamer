<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>HLS Stream</title>
</head>

<body>
  <h1 id="nativeVideoHeader" style="display:none;">Native video (mobile)</h1>

  <video id="nativeVideo" controls autoplay muted name="media" style="display:none;">
    <source src="http://localhost:3313/stream" type="application/vnd.apple.mpegurl">
  </video>

  <h1 id="hlsVideoHeader" style="display:none;">HLS video (desktop)</h1>
  <video id="hlsVideo" width="640" height="360" controls autoplay muted style="display:none;"></video>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    const isIOS = /iPad|iPhone|iPod|Android/.test(navigator.userAgent) && !window.MSStream;
    const nativeVideo = document.getElementById('nativeVideo');
    const hlsVideo = document.getElementById('hlsVideo');
    const nativeVideoHeader = document.getElementById('nativeVideoHeader');
    const hlsVideoHeader = document.getElementById('hlsVideoHeader');

    if (isIOS) {
      nativeVideo.style.display = 'block';
      nativeVideoHeader.style.display = 'block';
      nativeVideo.play();
    } else {
      hlsVideo.style.display = 'block';
      hlsVideoHeader.style.display = 'block';

      if (Hls.isSupported()) {
        const hls = new Hls({
          maxBufferLength: 10,
          maxBufferSize: 100000000,
          liveSyncDurationCount: 2,  // keep only two segments in buffer
          maxBufferLength: 1,  // in seconds
        });
        hls.loadSource('http://localhost:3313/stream');
        hls.attachMedia(hlsVideo);
        hls.on(Hls.Events.MANIFEST_PARSED, function () {
          hlsVideo.play();
        });
      } else if (hlsVideo.canPlayType('application/vnd.apple.mpegurl')) {
        hlsVideo.src = 'http://localhost:3313/stream';
        hlsVideo.addEventListener('loadedmetadata', function () {
          hlsVideo.play();
        });
      }
    }
  </script>
</body>

</html>